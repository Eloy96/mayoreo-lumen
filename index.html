<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VialPro E-commerce</title>
    
    <!-- 1. Cargar Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Cargar React y ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. Cargar Babel para interpretar JSX en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Estilos personalizados para ocultar scrollbars */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.4s ease-out forwards;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-white text-slate-800">

    <!-- Contenedor Principal de React -->
    <div id="root"></div>

    <!-- Lógica de la Aplicación -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- DEFINICIÓN DE ICONOS ---
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const ShoppingCart = (p) => <IconBase {...p}><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></IconBase>;
        const MenuIcon = (p) => <IconBase {...p}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></IconBase>;
        const X = (p) => <IconBase {...p}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>;
        const Search = (p) => <IconBase {...p}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconBase>;
        const ChevronRight = (p) => <IconBase {...p}><path d="m9 18 6-6-6-6"/></IconBase>;
        const ChevronLeft = (p) => <IconBase {...p}><path d="m15 18-6-6 6-6"/></IconBase>;
        const Star = (p) => <IconBase {...p}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></IconBase>;
        const Truck = (p) => <IconBase {...p}><path d="M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11"/><path d="M14 9h4l4 4v4c0 .6-.4 1-1 1h-2"/><circle cx="7" cy="18" r="2"/><path d="M15 18H9"/><circle cx="17" cy="18" r="2"/></IconBase>;
        const ShieldCheck = (p) => <IconBase {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></IconBase>;
        const Phone = (p) => <IconBase {...p}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></IconBase>;
        const MapPin = (p) => <IconBase {...p}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></IconBase>;
        const Facebook = (p) => <IconBase {...p}><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></IconBase>;
        const Instagram = (p) => <IconBase {...p}><rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/></IconBase>;
        const Linkedin = (p) => <IconBase {...p}><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect width="4" height="12" x="2" y="9"/><circle cx="4" cy="4" r="2"/></IconBase>;
        const CreditCard = (p) => <IconBase {...p}><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></IconBase>;
        const CheckCircle = (p) => <IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>;
        const ArrowRight = (p) => <IconBase {...p}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></IconBase>;
        const ArrowLeft = (p) => <IconBase {...p}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></IconBase>;
        const Info = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></IconBase>;
        const Mail = (p) => <IconBase {...p}><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></IconBase>;

        // --- DATOS (MOCK DATA) ---
        const CATEGORIES = [
            { id: 'vial', name: 'Señalización Vial', slug: 'senalizacion-vial', image: 'https://placehold.co/400x300/eab308/ffffff?text=Señales' },
            { id: 'proteccion', name: 'Protección de Obra', slug: 'proteccion-obra', image: 'https://placehold.co/400x300/f97316/ffffff?text=Protección' },
            { id: 'solar', name: 'Dispositivos Solares', slug: 'solar', image: 'https://placehold.co/400x300/3b82f6/ffffff?text=Solar' },
            { id: 'industrial', name: 'Seguridad Industrial', slug: 'seguridad-industrial', image: 'https://placehold.co/400x300/22c55e/ffffff?text=Industrial' },
        ];

        const BANNERS = [
            {
                id: 1,
                desktop: "https://placehold.co/1200x360/1e293b/fbbf24?text=Soluciones+Viales+Profesionales&font=montserrat",
                mobile: "https://placehold.co/500x500/1e293b/fbbf24?text=Soluciones+Viales\nProfesionales&font=montserrat",
                title: "Infraestructura Segura",
                linkCat: "vial"
            },
            {
                id: 2,
                desktop: "https://placehold.co/1200x360/ca8a04/ffffff?text=Envios+a+Todo+Mexico+Gratis&font=montserrat",
                mobile: "https://placehold.co/500x500/ca8a04/ffffff?text=Envios+Gratis\na+Todo+Mexico&font=montserrat",
                title: "Envíos Nacionales",
                linkCat: "proteccion"
            },
            {
                id: 3,
                desktop: "https://placehold.co/1200x360/dc2626/ffffff?text=Señalizacion+Normativa+SCT&font=montserrat",
                mobile: "https://placehold.co/500x500/dc2626/ffffff?text=Normativa+SCT\nCumplimiento+Total&font=montserrat",
                title: "Cumplimiento Normativo",
                linkCat: "industrial"
            }
        ];

        const PRODUCTS = [
            {
                id: 1,
                name: "Cono Vial Flexible 71cm",
                slug: "cono-vial-flexible-71cm",
                price: 185.00,
                category: "proteccion",
                image: "https://placehold.co/600x600/orange/white?text=Cono+Vial",
                description: "Cono de PVC naranja fluorescente con base negra pesada.",
                longDescription: "Fabricado en una sola pieza de PVC flexible con memoria (recupera su forma tras el impacto). Cuenta con base de caucho reciclado de alto peso para mayor estabilidad en carreteras con viento.",
                specs: ["Altura: 71 cm", "Peso: 2.5 kg", "Material: PVC Flexible"],
                rating: 5
            },
            {
                id: 2,
                name: "Señal Alto (SR-06)",
                slug: "senal-alto-sr06",
                price: 850.00,
                category: "vial",
                image: "https://placehold.co/600x600/red/white?text=ALTO",
                description: "Señal restrictiva octagonal de 61cm. Lámina galvanizada calibre 16.",
                longDescription: "Señal de tráfico SR-06 'ALTO' fabricada bajo normativa SCT vigente. Lámina galvanizada con tratamiento anticorrosivo y vinil reflejante de alta intensidad prismática.",
                specs: ["Dimensiones: 61x61 cm", "Calibre: 16", "Reflejante: Grado Ingeniería"],
                rating: 5
            },
            {
                id: 3,
                name: "Boya Metálica Solar",
                slug: "boya-metalica-solar",
                price: 320.00,
                category: "solar",
                image: "https://placehold.co/600x600/yellow/black?text=Boya+Solar",
                description: "Boya metálica con luz LED solar intermitente.",
                longDescription: "Dispositivo de seguridad vial inteligente. Se carga durante el día y se activa automáticamente al anochecer. Fabricada en acero troquelado de alta resistencia.",
                specs: ["Carga: Panel Solar", "Resistencia: 20 Toneladas", "Luz: LED Ámbar"],
                rating: 4
            },
            {
                id: 4,
                name: "Trafitambo Naranja",
                slug: "trafitambo-naranja",
                price: 450.00,
                category: "proteccion",
                image: "https://placehold.co/600x600/orange/white?text=Trafitambo",
                description: "Tambor de señalización vial fabricado en polietileno.",
                longDescription: "Elemento de canalización robusto y visible. Su diseño cónico permite apilarlos para optimizar espacio en transporte. Cuenta con asa superior para fácil manejo.",
                specs: ["Altura: 100 cm", "Diámetro base: 48 cm", "Peso: 4.5 kg"],
                rating: 5
            },
            {
                id: 5,
                name: "Chaleco Reflejante Brigadista",
                slug: "chaleco-reflejante-brigadista",
                price: 120.00,
                category: "industrial",
                image: "https://placehold.co/600x600/green/white?text=Chaleco",
                description: "Chaleco de malla con cintas reflejantes de 2 pulgadas.",
                longDescription: "Chaleco de seguridad industrial fabricado en malla de poliéster transpirable. Cuenta con cierre de cremallera frontal y cintas reflejantes textiles de alta luminosidad.",
                specs: ["Talla: Unitalla", "Material: Malla Poliéster", "Cierre: Cremallera"],
                rating: 4
            },
            {
                id: 6,
                name: "Reductor de Velocidad",
                slug: "reductor-velocidad-tope",
                price: 550.00,
                category: "vial",
                image: "https://placehold.co/600x600/black/yellow?text=Reductor",
                description: "Módulo central de caucho reciclado con ojos de gato.",
                longDescription: "Tope reductor de velocidad modular. Fabricado en hule reciclado vulcanizado con protección UV. Incluye ojos de gato reflejantes integrados para visibilidad nocturna.",
                specs: ["Largo: 50 cm", "Ancho: 35 cm", "Alto: 5 cm"],
                rating: 5
            },
            {
                id: 7,
                name: "Flecha Led Desviación",
                slug: "flecha-led-desviacion",
                price: 4200.00,
                category: "solar",
                image: "https://placehold.co/600x600/black/orange?text=Flecha+LED",
                description: "Tablero electrónico direccional con 15 focos LED ámbar.",
                longDescription: "Señal luminosa para desvío de tráfico en obras. Programable con 4 modos de destello (Izquierda, Derecha, Doble, Barra). Visible a más de 1km de distancia.",
                specs: ["LEDs: 15 de alto brillo", "Alimentación: 12V", "Modos: 4 secuencias"],
                rating: 5
            },
            {
                id: 8,
                name: "Barrera New Jersey",
                slug: "barrera-plastica-new-jersey",
                price: 2100.00,
                category: "proteccion",
                image: "https://placehold.co/600x600/orange/white?text=Barrera",
                description: "Barrera vial rellenable de agua o arena.",
                longDescription: "Barrera de contención vial tipo New Jersey. Fabricada en polietileno de alto peso molecular. Puede llenarse con agua o arena para aumentar su masa e inercia ante impactos.",
                specs: ["Largo: 150 cm", "Alto: 80 cm", "Capacidad: 150 Lts"],
                rating: 4
            }
        ];

        // --- COMPONENTES UI ---

        const Button = ({ children, onClick, variant = 'primary', className = '', fullWidth = false, disabled = false, type="button" }) => {
            const baseStyle = "px-6 py-3 rounded-lg font-bold transition-all duration-200 flex items-center justify-center gap-2";
            const variants = {
                primary: "bg-yellow-500 hover:bg-yellow-400 text-slate-900 shadow-lg hover:shadow-yellow-500/30",
                secondary: "bg-slate-800 hover:bg-slate-700 text-white border border-slate-700",
                outline: "border-2 border-yellow-500 text-yellow-600 hover:bg-yellow-50",
                ghost: "bg-transparent hover:bg-gray-100 text-slate-600",
                danger: "bg-red-500 hover:bg-red-600 text-white",
            };
            
            return (
                <button 
                    type={type}
                    className={`${baseStyle} ${variants[variant]} ${fullWidth ? 'w-full' : ''} ${className} ${disabled ? 'opacity-50 cursor-not-allowed' : ''}`}
                    onClick={onClick}
                    disabled={disabled}
                >
                    {children}
                </button>
            );
        };

        const ProductCarousel = ({ title, products, onProductClick, onAddToCart }) => {
            const scrollRef = useRef(null);

            const scroll = (direction) => {
                if(scrollRef.current) {
                    const { current } = scrollRef;
                    const scrollAmount = direction === 'left' ? -300 : 300;
                    current.scrollBy({ left: scrollAmount, behavior: 'smooth' });
                }
            };

            return (
                <section className="py-12 bg-white border-b border-gray-100">
                    <div className="container mx-auto px-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold text-slate-900 border-l-4 border-yellow-500 pl-3">{title}</h2>
                            <div className="flex gap-2">
                                <button onClick={() => scroll('left')} className="p-2 rounded-full hover:bg-gray-100 text-slate-600"><ChevronLeft/></button>
                                <button onClick={() => scroll('right')} className="p-2 rounded-full hover:bg-gray-100 text-slate-600"><ChevronRight/></button>
                            </div>
                        </div>
                        
                        <div 
                            ref={scrollRef}
                            className="flex gap-6 overflow-x-auto snap-x snap-mandatory pb-8 scrollbar-hide" 
                            style={{ scrollbarWidth: 'none', msOverflowStyle: 'none' }}
                        >
                            {products.map(product => (
                                <div 
                                    key={product.id} 
                                    className="min-w-[280px] md:min-w-[320px] snap-start bg-white rounded-xl border border-gray-100 shadow-sm hover:shadow-xl transition-all duration-300 flex flex-col group cursor-pointer"
                                    onClick={() => onProductClick(product)}
                                >
                                    <div className="aspect-square relative overflow-hidden bg-gray-50 rounded-t-xl p-4">
                                        <img src={product.image} alt={product.name} className="w-full h-full object-contain group-hover:scale-105 transition-transform duration-500" />
                                        <div className="absolute top-2 right-2 bg-white/90 px-2 py-1 rounded-full text-xs font-bold flex items-center gap-1 shadow-sm">
                                            <Star className="fill-yellow-400 text-yellow-400" size={12} /> {product.rating}
                                        </div>
                                    </div>
                                    <div className="p-4 flex-1 flex flex-col">
                                        <h3 className="font-bold text-slate-800 mb-1 group-hover:text-yellow-600 transition-colors line-clamp-1">{product.name}</h3>
                                        <p className="text-sm text-gray-500 mb-3 line-clamp-2">{product.description}</p>
                                        <div className="mt-auto flex items-center justify-between">
                                            <span className="font-bold text-xl text-slate-900">${product.price.toFixed(2)}</span>
                                            <button 
                                                onClick={(e) => { e.stopPropagation(); onAddToCart(product); }}
                                                className="bg-slate-900 text-white p-2 rounded-full hover:bg-yellow-500 hover:text-slate-900 transition-colors shadow-lg shadow-slate-900/20"
                                            >
                                                <ShoppingCart size={18} />
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </section>
            );
        };

        // --- APP PRINCIPAL ---

        function App() {
            const [view, setView] = useState('home');
            const [cart, setCart] = useState([]);
            const [activeCategory, setActiveCategory] = useState(null);
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            const [currentBanner, setCurrentBanner] = useState(0);
            
            // Estados para el buscador
            const [searchTerm, setSearchTerm] = useState('');
            const [searchResults, setSearchResults] = useState([]);

            const [shippingData, setShippingData] = useState({ name: '', email: '', address: '', city: '', cp: '' });
            const [isProcessing, setIsProcessing] = useState(false);

            // --- MANEJO DEL BUSCADOR ---
            const handleSearch = (e) => {
                const term = e.target.value;
                setSearchTerm(term);
                
                if (term.trim().length > 0) {
                    const results = PRODUCTS.filter(product => 
                        product.name.toLowerCase().includes(term.toLowerCase()) || 
                        product.description.toLowerCase().includes(term.toLowerCase())
                    );
                    setSearchResults(results);
                } else {
                    setSearchResults([]);
                }
            };

            // --- SISTEMA DE ENRUTADO (Hash Router) ---
            useEffect(() => {
                const handleHashChange = () => {
                    const hash = window.location.hash;

                    if (!hash || hash === '#/') {
                        setView('home');
                        document.title = 'VialPro | Inicio';
                    } else if (hash === '#/categorias') {
                        setView('categories');
                        document.title = 'VialPro | Categorías';
                    } else if (hash.startsWith('#/categoria/') && !hash.includes('/producto/')) {
                        const slug = hash.replace('#/categoria/', '');
                        const category = CATEGORIES.find(c => c.slug === slug);
                        if (category) {
                            setActiveCategory(category);
                            setView('product-list');
                            document.title = `VialPro | ${category.name}`;
                        }
                    } else if (hash.includes('/producto/')) {
                        // Nuevo formato: #/categoria/cat-slug/producto/prod-slug
                        const parts = hash.split('/');
                        const prodSlug = parts[parts.length - 1]; // Toma el último segmento
                        const product = PRODUCTS.find(p => p.slug === prodSlug);
                        
                        if (product) {
                            setSelectedProduct(product);
                            setView('product-detail');
                            document.title = `VialPro | ${product.name}`;
                        }
                    } else if (hash === '#/carrito') {
                        setView('cart');
                        document.title = 'VialPro | Carrito';
                    } else if (hash === '#/checkout/envio') {
                        setView('checkout-shipping');
                        document.title = 'VialPro | Envío';
                    } else if (hash === '#/checkout/pago') {
                        setView('checkout-payment');
                        document.title = 'VialPro | Pago';
                    } else if (hash === '#/confirmacion') {
                        setView('success');
                        document.title = 'VialPro | ¡Gracias!';
                    }
                    
                    window.scrollTo(0, 0);
                };

                window.addEventListener('hashchange', handleHashChange);
                handleHashChange();
                return () => window.removeEventListener('hashchange', handleHashChange);
            }, []);

            const navigate = (path) => { window.location.hash = path; };
            const goHome = () => navigate('/');
            const goToCategories = () => { setIsMenuOpen(false); navigate('/categorias'); };
            const goToProductList = (category) => { setActiveCategory(category); navigate(`/categoria/${category.slug}`); };
            
            // ACTUALIZADO: Navegación de producto ahora incluye categoría
            const goToProductDetail = (product) => { 
                const category = CATEGORIES.find(c => c.id === product.category);
                setSelectedProduct(product); 
                navigate(`/categoria/${category.slug}/producto/${product.slug}`); 
            };
            
            const goToCart = () => navigate('/carrito');

            useEffect(() => {
                const timer = setInterval(() => {
                    setCurrentBanner((prev) => (prev + 1) % BANNERS.length);
                }, 5000);
                return () => clearInterval(timer);
            }, []);

            const addToCart = (product, qty = 1) => {
                setCart(prev => {
                    const existing = prev.find(item => item.id === product.id);
                    if (existing) {
                        return prev.map(item => item.id === product.id ? { ...item, quantity: item.quantity + qty } : item);
                    }
                    return [...prev, { ...product, quantity: qty }];
                });
            };

            const removeFromCart = (productId) => {
                setCart(prev => prev.filter(item => item.id !== productId));
            };

            const updateQuantity = (productId, delta) => {
                setCart(prev => prev.map(item => {
                    if (item.id === productId) {
                        const newQty = Math.max(1, item.quantity + delta);
                        return { ...item, quantity: newQty };
                    }
                    return item;
                }));
            };

            const cartTotal = cart.reduce((acc, item) => acc + (item.price * item.quantity), 0);
            const handleAddToCartQuick = (product) => { addToCart(product); };

            // ... Render Functions ...
            
            const renderHome = () => (
                <div className="animate-fade-in">
                    <div className="relative w-full overflow-hidden bg-slate-900">
                        <div className="relative h-[500px] md:h-[360px] w-full max-w-[1200px] mx-auto">
                            {BANNERS.map((banner, index) => (
                                <div key={banner.id} className={`absolute inset-0 transition-opacity duration-1000 ease-in-out ${index === currentBanner ? 'opacity-100 z-10' : 'opacity-0 z-0'}`}>
                                    <img src={banner.mobile} alt={banner.title} className="w-full h-full object-cover md:hidden" />
                                    <img src={banner.desktop} alt={banner.title} className="hidden md:block w-full h-full object-cover" />
                                    <div className="absolute inset-0 bg-black/20 flex items-center justify-center">
                                        <div className="text-center">
                                            <Button onClick={() => goToProductList(CATEGORIES.find(c => c.id === banner.linkCat))}>
                                                Ver {banner.title}
                                            </Button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                            <div className="absolute bottom-4 left-0 right-0 flex justify-center gap-2 z-20">
                                {BANNERS.map((_, idx) => (
                                    <button key={idx} onClick={() => setCurrentBanner(idx)} className={`w-3 h-3 rounded-full transition-all ${idx === currentBanner ? 'bg-yellow-500 w-6' : 'bg-white/50'}`} />
                                ))}
                            </div>
                        </div>
                    </div>

                    <ProductCarousel title="Más Vendidos" products={PRODUCTS.slice(0, 4)} onProductClick={goToProductDetail} onAddToCart={handleAddToCartQuick} />
                    <ProductCarousel title="Novedades" products={PRODUCTS.slice(4, 8)} onProductClick={goToProductDetail} onAddToCart={handleAddToCartQuick} />

                    <div className="bg-slate-900 text-white py-16 text-center">
                        <h2 className="text-3xl font-bold mb-4">¿Buscas algo específico?</h2>
                        <p className="mb-8 text-gray-300">Explora nuestro catálogo completo dividido por categorías especializadas.</p>
                        <Button variant="outline" onClick={goToCategories}>Ver Categorías</Button>
                    </div>
                </div>
            );

            // Reutilizamos las funciones de renderizado anteriores...
            const renderCategoriesView = () => (
                <div className="container mx-auto px-6 py-12 animate-fade-in min-h-screen">
                    <h1 className="text-3xl font-bold text-slate-900 mb-8 flex items-center gap-2">
                        <MenuIcon className="text-yellow-500"/> Categorías de Productos
                    </h1>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                        {CATEGORIES.map(cat => (
                            <div key={cat.id} onClick={() => goToProductList(cat)} className="group cursor-pointer relative overflow-hidden rounded-2xl shadow-lg h-64 md:h-80">
                                <img src={cat.image} alt={cat.name} className="absolute inset-0 w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" />
                                <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent flex flex-col justify-end p-8">
                                    <h2 className="text-3xl font-bold text-white mb-2">{cat.name}</h2>
                                    <p className="text-yellow-400 font-medium flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity transform translate-y-4 group-hover:translate-y-0">
                                        Explorar Productos <ArrowRight size={20}/>
                                    </p>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );

            const renderProductList = () => {
                // Parseo avanzado para recuperar categoría desde URL compleja
                let displayCategory = activeCategory;
                if (!displayCategory) {
                    const hash = window.location.hash;
                    // Intenta sacar slug de: #/categoria/SLUG o #/categoria/SLUG/producto/PROD
                    const parts = hash.split('/');
                    const catIndex = parts.indexOf('categoria');
                    if (catIndex !== -1 && parts[catIndex + 1]) {
                         displayCategory = CATEGORIES.find(c => c.slug === parts[catIndex + 1]);
                    }
                }
                
                const filtered = displayCategory ? PRODUCTS.filter(p => p.category === displayCategory.id) : PRODUCTS;
                
                return (
                    <div className="container mx-auto px-6 py-12 min-h-screen animate-fade-in">
                        <div className="flex items-center gap-2 text-sm text-gray-500 mb-6">
                            <span onClick={goToCategories} className="cursor-pointer hover:text-yellow-600">Categorías</span>
                            <ChevronRight size={14}/>
                            <span className="font-bold text-slate-900">{displayCategory?.name || 'Todos'}</span>
                        </div>
                        <h1 className="text-3xl font-bold text-slate-900 mb-8">{displayCategory?.name}</h1>
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                            {filtered.map(product => (
                                <div key={product.id} onClick={() => goToProductDetail(product)} className="bg-white rounded-xl shadow-sm hover:shadow-xl transition-all border border-gray-100 overflow-hidden cursor-pointer group">
                                    <div className="aspect-square p-6 bg-gray-50 relative">
                                        <img src={product.image} alt={product.name} className="w-full h-full object-contain group-hover:scale-105 transition-transform"/>
                                    </div>
                                    <div className="p-6">
                                        <h3 className="font-bold text-lg text-slate-900 mb-2">{product.name}</h3>
                                        <div className="flex justify-between items-end mt-4">
                                            <span className="text-2xl font-bold text-slate-900">${product.price.toFixed(2)}</span>
                                            <Button className="p-3 rounded-full" onClick={(e) => { e.stopPropagation(); addToCart(product); }}>
                                                <ShoppingCart size={20}/>
                                            </Button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            const renderProductDetail = () => {
                // Recuperación segura del producto desde URL
                let displayProduct = selectedProduct;
                if (!displayProduct) {
                    const parts = window.location.hash.split('/');
                    const prodSlug = parts[parts.length - 1];
                    displayProduct = PRODUCTS.find(p => p.slug === prodSlug);
                }

                if (!displayProduct) return <div className="p-12 text-center">Cargando producto...</div>;
                const category = CATEGORIES.find(c => c.id === displayProduct.category);

                return (
                    <div className="container mx-auto px-6 py-8 animate-fade-in min-h-screen">
                        
                        {/* BREADCRUMBS (MIGAS DE PAN) */}
                        <nav className="flex items-center text-sm text-gray-500 mb-6 overflow-x-auto whitespace-nowrap">
                            <span onClick={goHome} className="cursor-pointer hover:text-yellow-600 hover:underline">Inicio</span>
                            <ChevronRight size={14} className="mx-2 text-gray-400"/>
                            <span onClick={() => goToProductList(category)} className="cursor-pointer hover:text-yellow-600 hover:underline">{category?.name}</span>
                            <ChevronRight size={14} className="mx-2 text-gray-400"/>
                            <span className="font-bold text-slate-900">{displayProduct.name}</span>
                        </nav>

                        <div className="bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden flex flex-col lg:flex-row">
                            <div className="lg:w-1/2 bg-gray-50 p-12 flex items-center justify-center">
                                <img src={displayProduct.image} alt={displayProduct.name} className="max-w-full max-h-[500px] object-contain drop-shadow-2xl"/>
                            </div>
                            <div className="lg:w-1/2 p-8 lg:p-12 flex flex-col justify-center">
                                <div className="text-sm text-yellow-600 font-bold uppercase tracking-wider mb-2">
                                    {category?.name}
                                </div>
                                <h1 className="text-4xl font-extrabold text-slate-900 mb-4">{displayProduct.name}</h1>
                                <div className="flex items-center gap-4 mb-6">
                                    <span className="text-3xl font-bold text-slate-900">${displayProduct.price.toFixed(2)}</span>
                                    <div className="flex text-yellow-400"><Star className="fill-current" size={20}/> <Star className="fill-current" size={20}/> <Star className="fill-current" size={20}/> <Star className="fill-current" size={20}/> <Star className="fill-current" size={20}/></div>
                                </div>
                                <p className="text-gray-600 text-lg leading-relaxed mb-8">{displayProduct.longDescription}</p>
                                <div className="bg-slate-50 rounded-xl p-6 mb-8">
                                    <h3 className="font-bold text-slate-900 mb-3">Especificaciones:</h3>
                                    <ul className="grid grid-cols-2 gap-2 text-sm text-gray-600">
                                        {displayProduct.specs.map((spec, i) => <li key={i} className="flex items-center gap-2"><div className="w-1.5 h-1.5 bg-yellow-500 rounded-full"/> {spec}</li>)}
                                    </ul>
                                </div>
                                <div className="flex gap-4">
                                    <Button fullWidth onClick={() => { addToCart(displayProduct); navigate('/carrito'); }}>
                                        Agregar al Carrito
                                    </Button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const renderCart = () => (
                <div className="container mx-auto px-6 py-12 min-h-screen animate-fade-in max-w-4xl">
                    <h2 className="text-3xl font-bold mb-8 flex items-center gap-3">
                        <ShoppingCart className="text-yellow-500" size={32}/> Tu Carrito
                    </h2>
                    {cart.length === 0 ? (
                        <div className="text-center py-20 bg-gray-50 rounded-2xl">
                            <p className="text-gray-500 text-xl mb-6">Tu carrito está vacío</p>
                            <Button onClick={goToCategories}>Ir a Comprar</Button>
                        </div>
                    ) : (
                        <div className="flex flex-col gap-6">
                            {cart.map(item => (
                                <div key={item.id} className="flex items-center gap-4 bg-white p-4 rounded-xl border border-gray-100 shadow-sm">
                                    <img src={item.image} className="w-20 h-20 object-contain bg-gray-50 rounded-lg" alt=""/>
                                    <div className="flex-1">
                                        <h3 className="font-bold text-slate-900">{item.name}</h3>
                                        <p className="text-yellow-600 font-bold">${item.price.toFixed(2)}</p>
                                    </div>
                                    <div className="flex items-center gap-3 bg-gray-50 rounded-lg p-1">
                                        <button onClick={() => updateQuantity(item.id, -1)} className="w-8 h-8 flex items-center justify-center hover:bg-white rounded">-</button>
                                        <span className="font-bold">{item.quantity}</span>
                                        <button onClick={() => updateQuantity(item.id, 1)} className="w-8 h-8 flex items-center justify-center hover:bg-white rounded">+</button>
                                    </div>
                                    <button onClick={() => removeFromCart(item.id)} className="text-red-400 hover:text-red-600 p-2"><X size={20}/></button>
                                </div>
                            ))}
                            <div className="mt-8 flex justify-end items-center gap-8 border-t pt-8">
                                <div className="text-right">
                                    <p className="text-gray-500">Total a Pagar</p>
                                    <p className="text-3xl font-bold text-slate-900">${cartTotal.toFixed(2)}</p>
                                </div>
                                <Button onClick={() => navigate('/checkout/envio')}>
                                    Proceder a Datos de Entrega <ArrowRight size={20}/>
                                </Button>
                            </div>
                        </div>
                    )}
                </div>
            );

            const renderCheckoutShipping = () => (
                <div className="container mx-auto px-6 py-12 min-h-screen max-w-2xl animate-fade-in">
                    <div className="flex items-center justify-between mb-10 text-sm font-bold text-gray-400">
                        <div className="flex items-center gap-2 text-green-600"><CheckCircle size={20}/> Carrito</div>
                        <div className="h-1 bg-yellow-500 flex-1 mx-4"></div>
                        <div className="flex items-center gap-2 text-slate-900"><MapPin size={20} className="text-yellow-500"/> Datos Entrega</div>
                        <div className="h-1 bg-gray-200 flex-1 mx-4"></div>
                        <div className="flex items-center gap-2"><CreditCard size={20}/> Pago</div>
                    </div>
                    <h2 className="text-2xl font-bold mb-6 text-slate-900">Datos de Envío</h2>
                    <form onSubmit={(e) => { e.preventDefault(); navigate('/checkout/pago'); }} className="space-y-6">
                        <div className="grid grid-cols-2 gap-6">
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">Nombre Completo</label>
                                <input required value={shippingData.name} onChange={e=>setShippingData({...shippingData, name: e.target.value})} type="text" className="w-full p-3 rounded-lg border border-gray-300 outline-none focus:border-yellow-500" placeholder="Ej. Juan Pérez"/>
                            </div>
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">Correo Electrónico</label>
                                <input required value={shippingData.email} onChange={e=>setShippingData({...shippingData, email: e.target.value})} type="email" className="w-full p-3 rounded-lg border border-gray-300 outline-none focus:border-yellow-500" placeholder="email@ejemplo.com"/>
                            </div>
                        </div>
                        <div>
                            <label className="block text-sm font-bold text-gray-700 mb-2">Dirección Completa</label>
                            <input required value={shippingData.address} onChange={e=>setShippingData({...shippingData, address: e.target.value})} type="text" className="w-full p-3 rounded-lg border border-gray-300 outline-none focus:border-yellow-500" placeholder="Calle, Número, Colonia"/>
                        </div>
                        <div className="grid grid-cols-2 gap-6">
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">Ciudad</label>
                                <input required value={shippingData.city} onChange={e=>setShippingData({...shippingData, city: e.target.value})} type="text" className="w-full p-3 rounded-lg border border-gray-300 outline-none focus:border-yellow-500"/>
                            </div>
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">Código Postal</label>
                                <input required value={shippingData.cp} onChange={e=>setShippingData({...shippingData, cp: e.target.value})} type="text" className="w-full p-3 rounded-lg border border-gray-300 outline-none focus:border-yellow-500"/>
                            </div>
                        </div>
                        <div className="flex justify-between pt-6">
                            <Button variant="ghost" onClick={() => navigate('/carrito')}>Atrás</Button>
                            <Button type="submit">Continuar al Pago <ArrowRight size={20}/></Button>
                        </div>
                    </form>
                </div>
            );

            const renderCheckoutPayment = () => (
                <div className="container mx-auto px-6 py-12 min-h-screen max-w-2xl animate-fade-in">
                    <div className="flex items-center justify-between mb-10 text-sm font-bold text-gray-400">
                        <div className="flex items-center gap-2 text-green-600"><CheckCircle size={20}/> Carrito</div>
                        <div className="h-1 bg-green-500 flex-1 mx-4"></div>
                        <div className="flex items-center gap-2 text-green-600"><CheckCircle size={20}/> Datos Entrega</div>
                        <div className="h-1 bg-yellow-500 flex-1 mx-4"></div>
                        <div className="flex items-center gap-2 text-slate-900"><CreditCard size={20} className="text-yellow-500"/> Pago</div>
                    </div>
                    <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-8 text-sm text-yellow-800 flex items-center gap-3">
                        <Info size={20}/> Estás a un paso. Revisa tu pedido antes de pagar.
                    </div>
                    <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm mb-8">
                        <h3 className="font-bold mb-4">Resumen del Pedido</h3>
                        {cart.map(item => (
                            <div key={item.id} className="flex justify-between text-sm py-2 border-b border-gray-100 last:border-0">
                                <span>{item.name} (x{item.quantity})</span>
                                <span className="font-mono">${(item.price * item.quantity).toFixed(2)}</span>
                            </div>
                        ))}
                        <div className="flex justify-between font-bold text-lg mt-4 pt-4 border-t">
                            <span>Total a Pagar</span>
                            <span>${cartTotal.toFixed(2)}</span>
                        </div>
                    </div>
                    <form onSubmit={(e) => { 
                        e.preventDefault(); 
                        setIsProcessing(true);
                        setTimeout(() => { setIsProcessing(false); navigate('/confirmacion'); setCart([]); }, 2000);
                    }} className="space-y-6">
                        <div>
                            <label className="block text-sm font-bold text-gray-700 mb-2">Número de Tarjeta</label>
                            <div className="relative">
                                <CreditCard className="absolute left-3 top-3 text-gray-400" size={20}/>
                                <input required type="text" placeholder="0000 0000 0000 0000" className="w-full pl-10 p-3 rounded-lg border border-gray-300 outline-none focus:border-yellow-500"/>
                            </div>
                        </div>
                        <div className="grid grid-cols-2 gap-6">
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">Vencimiento</label>
                                <input required type="text" placeholder="MM/AA" className="w-full p-3 rounded-lg border border-gray-300 outline-none focus:border-yellow-500 text-center"/>
                            </div>
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">CVV</label>
                                <input required type="password" placeholder="123" maxLength="3" className="w-full p-3 rounded-lg border border-gray-300 outline-none focus:border-yellow-500 text-center"/>
                            </div>
                        </div>
                        <div className="flex justify-between pt-6">
                            <Button variant="ghost" onClick={() => navigate('/checkout/envio')} disabled={isProcessing}>Atrás</Button>
                            <Button type="submit" disabled={isProcessing}>
                                {isProcessing ? 'Procesando...' : `Pagar $${cartTotal.toFixed(2)}`}
                            </Button>
                        </div>
                    </form>
                </div>
            );

            const renderSuccess = () => (
                <div className="min-h-screen bg-slate-50 flex items-center justify-center p-6 animate-fade-in">
                    <div className="bg-white max-w-lg w-full rounded-2xl shadow-xl overflow-hidden">
                        <div className="bg-green-500 p-8 text-center text-white">
                            <div className="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4 backdrop-blur-sm">
                                <CheckCircle size={40} className="text-white"/>
                            </div>
                            <h2 className="text-3xl font-extrabold mb-2">¡Pago Exitoso!</h2>
                            <p className="text-green-100">Tu orden #VP-{Math.floor(Math.random()*10000)} ha sido confirmada.</p>
                        </div>
                        <div className="p-8">
                            <div className="bg-blue-50 text-blue-800 p-4 rounded-lg mb-6 flex items-start gap-3 text-sm">
                                <Mail className="mt-1 flex-shrink-0" size={18}/>
                                <p>Hemos enviado un correo de confirmación a <strong>{shippingData.email}</strong> con los detalles de tu pedido y guía de rastreo.</p>
                            </div>
                            <h3 className="font-bold text-gray-900 mb-4 border-b pb-2">Resumen de Envío</h3>
                            <div className="space-y-2 text-sm text-gray-600 mb-8">
                                <p><span className="font-bold">Recibe:</span> {shippingData.name}</p>
                                <p><span className="font-bold">Dirección:</span> {shippingData.address}, {shippingData.city}, CP {shippingData.cp}</p>
                                <p><span className="font-bold">Método:</span> Envío Estándar (3-5 días)</p>
                            </div>
                            <Button fullWidth onClick={() => { goHome(); setShippingData({name:'',email:'',address:'',city:'',cp:''}); }}>
                                Volver al Inicio
                            </Button>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="font-sans text-slate-800 min-h-screen bg-white flex flex-col">
                    <header className="sticky top-0 z-50 bg-slate-900 text-white shadow-lg">
                        <div className="container mx-auto px-6 h-20 flex items-center justify-between">
                            <div onClick={goHome} className="flex items-center gap-2 cursor-pointer hover:opacity-90">
                                <div className="bg-yellow-500 p-2 rounded-lg"><Truck className="text-slate-900" size={24} /></div>
                                <span className="text-2xl font-bold tracking-tight hidden sm:block">Vial<span className="text-yellow-500">Pro</span></span>
                            </div>
                            
                            {/* --- BUSCADOR CENTRAL --- */}
                            <div className="hidden lg:flex items-center flex-1 max-w-xl mx-12">
                                <div className="relative w-full z-50">
                                    <input 
                                        type="text" 
                                        placeholder="Buscar productos (ej. Cono, Señal)..." 
                                        className="w-full py-2.5 pl-4 pr-10 rounded-full bg-slate-800 border border-slate-700 focus:border-yellow-500 focus:outline-none text-white placeholder-slate-400"
                                        value={searchTerm}
                                        onChange={handleSearch}
                                    />
                                    {searchTerm.length > 0 && (
                                         <button 
                                            onClick={() => { setSearchTerm(''); setSearchResults([]); }}
                                            className="absolute right-10 top-2.5 text-slate-400 hover:text-white"
                                        >
                                            <X size={16} />
                                        </button>
                                    )}
                                    <Search size={18} className="absolute right-3 top-3 text-slate-400" />
                                    
                                    {/* LISTA DE RESULTADOS (DROPDOWN) */}
                                    {searchTerm.length > 0 && (
                                        <div className="absolute top-full left-0 right-0 bg-white rounded-xl shadow-2xl border border-gray-100 mt-2 overflow-hidden max-h-[400px] overflow-y-auto">
                                            {searchResults.length > 0 ? (
                                                searchResults.map(product => (
                                                    <div 
                                                        key={product.id}
                                                        onClick={() => {
                                                            goToProductDetail(product);
                                                            setSearchTerm(''); // Limpiar busqueda al seleccionar
                                                            setSearchResults([]);
                                                        }}
                                                        className="flex items-center gap-4 p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-0 transition-colors"
                                                    >
                                                        <div className="w-12 h-12 bg-gray-50 rounded-lg flex items-center justify-center p-1">
                                                            <img src={product.image} alt={product.name} className="w-full h-full object-contain"/>
                                                        </div>
                                                        <div className="flex-1 text-left">
                                                            <p className="font-bold text-sm text-slate-900 line-clamp-1">{product.name}</p>
                                                            <p className="text-xs text-gray-500 line-clamp-1">{product.description}</p>
                                                        </div>
                                                        <div className="text-right">
                                                            <p className="text-sm font-bold text-yellow-600">${product.price.toFixed(2)}</p>
                                                        </div>
                                                    </div>
                                                ))
                                            ) : (
                                                <div className="p-4 text-center text-gray-500 text-sm">
                                                    No se encontraron productos para "{searchTerm}"
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-6">
                                <button className="hidden md:flex items-center gap-2 font-bold hover:text-yellow-400 transition-colors" onClick={goToCategories}>
                                    <MenuIcon size={20}/> Categorías
                                </button>
                                <div className="relative cursor-pointer group" onClick={goToCart}>
                                    <ShoppingCart className="group-hover:text-yellow-400 transition-colors" size={26} />
                                    {cart.length > 0 && (
                                        <span className="bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full absolute -top-2 -right-2 animate-bounce">
                                            {cart.reduce((acc, i) => acc + i.quantity, 0)}
                                        </span>
                                    )}
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="flex-1">
                        {view === 'home' && renderHome()}
                        {view === 'categories' && renderCategoriesView()}
                        {view === 'product-list' && renderProductList()}
                        {view === 'product-detail' && renderProductDetail()}
                        {view === 'cart' && renderCart()}
                        {view === 'checkout-shipping' && renderCheckoutShipping()}
                        {view === 'checkout-payment' && renderCheckoutPayment()}
                        {view === 'success' && renderSuccess()}
                    </main>

                    <footer className="bg-slate-900 text-slate-400 py-12 border-t border-slate-800 mt-auto">
                        <div className="container mx-auto px-6 text-center md:text-left grid grid-cols-1 md:grid-cols-4 gap-8">
                            <div>
                                <h4 className="text-white font-bold text-lg mb-4">VialPro</h4>
                                <p className="text-sm">Líderes en señalización y seguridad industrial en México.</p>
                            </div>
                            <div>
                                <h4 className="text-white font-bold mb-4">Contacto</h4>
                                <p className="text-sm mb-2">ventas@vialpro.mx</p>
                                <p className="text-sm">(55) 1234 5678</p>
                            </div>
                            <div>
                                <h4 className="text-white font-bold mb-4">Legal</h4>
                                <p className="text-sm mb-2">Términos y Condiciones</p>
                                <p className="text-sm">Aviso de Privacidad</p>
                            </div>
                            <div>
                                <h4 className="text-white font-bold mb-4">Redes</h4>
                                <div className="flex justify-center md:justify-start gap-4">
                                    <Facebook size={20}/> <Instagram size={20}/> <Linkedin size={20}/>
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
