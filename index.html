<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VialPro E-commerce</title>
    
    <!-- 1. Cargar Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Cargar React y ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. Cargar Babel para interpretar JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 4. Cargar PapaParse para leer Google Sheets (CSV) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.4s ease-out forwards; }
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-white text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- CONFIGURACIÓN DE GOOGLE APPS SCRIPT ---
        // URL de tu despliegue (Web App)
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyPnLM6PF2NQxC6ulguExbM5IStTtV3rFfqS1TML989o2fDSNP4iv5PT72H5GqBq4FvXw/exec"; 

        // --- ICONOS ---
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const ShoppingCart = (p) => <IconBase {...p}><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></IconBase>;
        const MenuIcon = (p) => <IconBase {...p}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></IconBase>;
        const X = (p) => <IconBase {...p}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>;
        const Search = (p) => <IconBase {...p}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconBase>;
        const ChevronRight = (p) => <IconBase {...p}><path d="m9 18 6-6-6-6"/></IconBase>;
        const ChevronLeft = (p) => <IconBase {...p}><path d="m15 18-6-6 6-6"/></IconBase>;
        // Star icon removed
        const Truck = (p) => <IconBase {...p}><path d="M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11"/><path d="M14 9h4l4 4v4c0 .6-.4 1-1 1h-2"/><circle cx="7" cy="18" r="2"/><path d="M15 18H9"/><circle cx="17" cy="18" r="2"/></IconBase>;
        const ShieldCheck = (p) => <IconBase {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></IconBase>;
        const Phone = (p) => <IconBase {...p}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></IconBase>;
        const MapPin = (p) => <IconBase {...p}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></IconBase>;
        const Facebook = (p) => <IconBase {...p}><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></IconBase>;
        const Instagram = (p) => <IconBase {...p}><rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/></IconBase>;
        const Linkedin = (p) => <IconBase {...p}><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect width="4" height="12" x="2" y="9"/><circle cx="4" cy="4" r="2"/></IconBase>;
        const CreditCard = (p) => <IconBase {...p}><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></IconBase>;
        const CheckCircle = (p) => <IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>;
        const ArrowRight = (p) => <IconBase {...p}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></IconBase>;
        const ArrowLeft = (p) => <IconBase {...p}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></IconBase>;
        const Info = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></IconBase>;
        const Mail = (p) => <IconBase {...p}><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></IconBase>;
        const FilterIcon = (p) => <IconBase {...p}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></IconBase>;

        // --- DATOS DE EJEMPLO (FALLBACK) ---
        const MOCK_PRODUCTS = [
            { id: "CN-71-OR", name: "Cono Vial Flexible 71cm", slug: "cono-vial-flexible-71cm", price: 185.00, category: "Protección de Obra", image: "https://placehold.co/600x600/orange/white?text=Cono+Vial", description: "Cono de PVC naranja...", longDescription: "Fabricado en una sola pieza de PVC flexible con memoria (recupera su forma tras el impacto). Cuenta con base de caucho reciclado de alto peso para mayor estabilidad en carreteras con viento.", specs: "Altura: 71 cm|Peso: 2.5 kg|Material: PVC Flexible", sku: 'CN-71-OR' },
            { id: "SR-06", name: "Señal Alto (SR-06)", slug: "senal-alto-sr06", price: 850.00, category: "Señalización Vial", image: "https://placehold.co/600x600/red/white?text=ALTO", description: "Señal restrictiva...", longDescription: "Señal de tráfico SR-06 'ALTO' fabricada bajo normativa SCT vigente. Lámina galvanizada con tratamiento anticorrosivo y vinil reflejante de alta intensidad prismática.", specs: "Dimensiones: 61x61 cm|Calibre: 16|Reflejante: Grado Ingeniería", sku: 'SR-06' },
            { id: "BY-SOL", name: "Boya Metálica Solar", slug: "boya-metalica-solar", price: 320.00, category: "Dispositivos Solares", image: "https://placehold.co/600x600/yellow/black?text=Boya+Solar", description: "Boya metálica...", longDescription: "Dispositivo de seguridad vial inteligente. Se carga durante el día y se activa automáticamente al anochecer. Fabricada en acero troquelado de alta resistencia.", specs: "Carga: Panel Solar|Resistencia: 20 Toneladas|Luz: LED Ámbar", sku: 'BY-SOL' },
            { id: "CH-BRIG", name: "Chaleco Brigadista", slug: "chaleco-brigadista", price: 120.00, category: "Seguridad Industrial", image: "https://placehold.co/600x600/green/white?text=Chaleco", description: "Chaleco malla...", longDescription: "Chaleco de seguridad industrial fabricado en malla de poliéster transpirable. Cuenta con cierre de cremallera frontal y cintas reflejantes textiles de alta luminosidad.", specs: "Talla: Unitalla|Material: Malla Poliéster|Cierre: Cremallera", sku: 'CH-BRIG' },
        ];

        const BANNERS = [
            { id: 1, desktop: "https://placehold.co/1200x360/1e293b/fbbf24?text=Soluciones+Viales", mobile: "https://placehold.co/500x500/1e293b/fbbf24?text=Soluciones+Viales", title: "Infraestructura Segura", linkCat: "Señalización Vial" },
            { id: 2, desktop: "https://placehold.co/1200x360/ca8a04/ffffff?text=Envios+Gratis", mobile: "https://placehold.co/500x500/ca8a04/ffffff?text=Envios+Gratis", title: "Envíos Nacionales", linkCat: "Protección de Obra" },
        ];

        // --- COMPONENTES UI ---
        const Button = ({ children, onClick, variant = 'primary', className = '', fullWidth = false, disabled = false }) => {
            const baseStyle = "px-6 py-3 rounded-lg font-bold transition-all duration-200 flex items-center justify-center gap-2";
            const variants = {
                primary: "bg-yellow-500 hover:bg-yellow-400 text-slate-900 shadow-lg hover:shadow-yellow-500/30",
                secondary: "bg-slate-800 hover:bg-slate-700 text-white border border-slate-700",
                outline: "border-2 border-yellow-500 text-yellow-600 hover:bg-yellow-50",
                ghost: "bg-transparent hover:bg-gray-100 text-slate-600"
            };
            return <button className={`${baseStyle} ${variants[variant]} ${fullWidth ? 'w-full' : ''} ${className} ${disabled ? 'opacity-50 cursor-not-allowed' : ''}`} onClick={onClick} disabled={disabled}>{children}</button>;
        };

        const ProductCarousel = ({ title, products, onProductClick, onAddToCart }) => {
            const scrollRef = useRef(null);
            const scroll = (d) => { if(scrollRef.current) scrollRef.current.scrollBy({ left: d === 'left' ? -300 : 300, behavior: 'smooth' }); };
            if (!products || products.length === 0) return null;
            return (
                <section className="py-12 bg-white border-b border-gray-100">
                    <div className="container mx-auto px-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold text-slate-900 border-l-4 border-yellow-500 pl-3">{title}</h2>
                            <div className="flex gap-2">
                                <button onClick={() => scroll('left')} className="p-2 rounded-full hover:bg-gray-100"><ChevronLeft/></button>
                                <button onClick={() => scroll('right')} className="p-2 rounded-full hover:bg-gray-100"><ChevronRight/></button>
                            </div>
                        </div>
                        <div ref={scrollRef} className="flex gap-6 overflow-x-auto snap-x snap-mandatory pb-8 scrollbar-hide" style={{ scrollbarWidth: 'none', msOverflowStyle: 'none' }}>
                            {products.map(p => (
                                <div key={p.id} className="min-w-[280px] snap-start bg-white rounded-xl border border-gray-100 shadow-sm hover:shadow-xl transition-all cursor-pointer group" onClick={() => onProductClick(p)}>
                                    <div className="aspect-square relative p-4 bg-gray-50 rounded-t-xl"><img src={p.image} className="w-full h-full object-contain group-hover:scale-105 transition-transform" /></div>
                                    <div className="p-4"><h3 className="font-bold text-slate-800 line-clamp-1">{p.name}</h3><p className="text-sm text-gray-500 mb-2">${p.price.toFixed(2)}</p><Button className="py-2 text-sm" fullWidth onClick={(e)=>{e.stopPropagation();onAddToCart(p)}}>Agregar</Button></div>
                                </div>
                            ))}
                        </div>
                    </div>
                </section>
            );
        };

        // --- APP PRINCIPAL ---
        function App() {
            const [view, setView] = useState('home');
            const [products, setProducts] = useState([]);
            const [categories, setCategories] = useState([]);
            const [cart, setCart] = useState([]);
            const [activeCategory, setActiveCategory] = useState(null); // String name of category or null
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            const [currentBanner, setCurrentBanner] = useState(0);
            
            // Filtros Dinámicos
            const [activeFilters, setActiveFilters] = useState({ categories: [], minPrice: 0, maxPrice: 10000 });
            const [searchTerm, setSearchTerm] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [shippingData, setShippingData] = useState({ name: '', email: '', address: '', city: '', cp: '' });
            const [isProcessing, setIsProcessing] = useState(false);

            // --- CARGA DE DATOS (SHEETS O MOCK) ---
            useEffect(() => {
                const loadData = async () => {
                    if (GOOGLE_SCRIPT_URL) {
                        try {
                            const response = await fetch(GOOGLE_SCRIPT_URL);
                            const data = await response.json();
                            
                            const loadedProducts = data
                                .filter(row => (row.sku || row.id) && row.name)
                                .map(row => ({
                                    ...row,
                                    id: row.sku || row.id, // ID principal es SKU
                                    price: parseFloat(row.price) || 0,
                                    specs: row.specs ? row.specs.split('|').map(s => s.trim()) : []
                                }));
                            
                            setProducts(loadedProducts);
                            processCategories(loadedProducts);
                        } catch (error) {
                            console.error("Error cargando desde Apps Script:", error);
                            // Fallback
                            setProducts(MOCK_PRODUCTS);
                            processCategories(MOCK_PRODUCTS);
                        }
                    } else {
                        setProducts(MOCK_PRODUCTS);
                        processCategories(MOCK_PRODUCTS);
                    }
                };
                loadData();
            }, []);

            const processCategories = (prods) => {
                // Extraer categorías únicas automáticamente del Sheet
                const cats = [...new Set(prods.map(p => p.category))].filter(Boolean).map(c => ({
                    id: c, // Usamos el nombre como ID para simplificar si no hay ID explícito en sheet
                    name: c,
                    slug: c.toLowerCase().replace(/ /g, '-')
                }));
                setCategories(cats);
            };

            // --- LÓGICA DE FILTROS ---
            const toggleCategoryFilter = (catName) => {
                setActiveFilters(prev => {
                    const exists = prev.categories.includes(catName);
                    return {
                        ...prev,
                        categories: exists 
                            ? prev.categories.filter(c => c !== catName)
                            : [...prev.categories, catName]
                    };
                });
            };

            const getFilteredProducts = () => {
                let filtered = products;
                // 1. Filtro principal de vista (si vienes del home por categoría)
                if (activeCategory) {
                    filtered = filtered.filter(p => p.category === activeCategory);
                }
                // 2. Filtros laterales (Checkboxes)
                if (activeFilters.categories.length > 0) {
                    filtered = filtered.filter(p => activeFilters.categories.includes(p.category));
                }
                return filtered;
            };

            // --- ENRUTADO ---
            useEffect(() => {
                const handleHashChange = () => {
                    const hash = window.location.hash;
                    if (!hash || hash === '#/') {
                        setView('home'); 
                        setActiveCategory(null);
                    } else if (hash === '#/categorias') {
                        setView('categories');
                    } else if (hash.includes('/producto/')) {
                        const parts = hash.split('/');
                        const prodSlug = parts[parts.length - 1];
                        // Esperar a que carguen productos si es carga inicial
                        const product = products.find(p => p.slug === prodSlug);
                        if (product) { setSelectedProduct(product); setView('product-detail'); }
                    } else if (hash.startsWith('#/categoria/')) {
                        const slug = hash.replace('#/categoria/', '');
                        const cat = categories.find(c => c.slug === slug);
                        if(cat) setActiveCategory(cat.name);
                        setView('product-list');
                    } else if (hash === '#/carrito') setView('cart');
                    else if (hash === '#/checkout/envio') setView('checkout-shipping');
                    else if (hash === '#/checkout/pago') setView('checkout-payment');
                    else if (hash === '#/confirmacion') setView('success');
                    window.scrollTo(0, 0);
                };
                window.addEventListener('hashchange', handleHashChange);
                if (products.length > 0) handleHashChange(); // Re-ejecutar cuando carguen productos
                return () => window.removeEventListener('hashchange', handleHashChange);
            }, [products, categories]);

            const navigate = (path) => { window.location.hash = path; };
            const goHome = () => navigate('/');
            const goToCategories = () => { setIsMenuOpen(false); navigate('/categorias'); };
            const goToProductList = (catName) => { 
                const cat = categories.find(c => c.name === catName);
                if(cat) navigate(`/categoria/${cat.slug}`);
                else {
                    navigate(`/categoria/${catName.toLowerCase().replace(/ /g, '-')}`);
                }
            };
            const goToProductDetail = (p) => { 
                const catSlug = p.category.toLowerCase().replace(/ /g, '-');
                navigate(`/categoria/${catSlug}/producto/${p.slug}`); 
            };

            // --- CARRITO ---
            const addToCart = (p, qty=1) => setCart(prev => {
                const ex = prev.find(i => i.id === p.id);
                return ex ? prev.map(i => i.id === p.id ? {...i, quantity: i.quantity + qty} : i) : [...prev, {...p, quantity: qty}];
            });
            const updateQty = (id, d) => setCart(prev => prev.map(i => i.id === id ? {...i, quantity: Math.max(1, i.quantity + d)} : i));
            const remove = (id) => setCart(prev => prev.filter(i => i.id !== id));
            const cartTotal = cart.reduce((acc, i) => acc + i.price * i.quantity, 0);

            // --- BUSCADOR ---
            const handleSearch = (e) => {
                const term = e.target.value;
                setSearchTerm(term);
                if (term.trim().length > 0) {
                    setSearchResults(products.filter(p => p.name.toLowerCase().includes(term.toLowerCase())));
                } else setSearchResults([]);
            };

            // --- RENDERIZADORES ---
            const renderHome = () => (
                <div className="animate-fade-in">
                    {/* Banners */}
                    <div className="relative w-full bg-slate-900 overflow-hidden h-[400px] md:h-[360px]">
                        {BANNERS.map((b, i) => (
                            <div key={b.id} className={`absolute inset-0 transition-opacity duration-1000 ${i === currentBanner ? 'opacity-100' : 'opacity-0'}`}>
                                <img src={b.desktop} className="hidden md:block w-full h-full object-cover" />
                                <img src={b.mobile} className="md:hidden w-full h-full object-cover" />
                                <div className="absolute inset-0 bg-black/30 flex items-center justify-center">
                                    <Button onClick={() => goToProductList(b.linkCat)}>Ver {b.title}</Button>
                                </div>
                            </div>
                        ))}
                    </div>
                    {/* Listas automáticas */}
                    <ProductCarousel title="Destacados" products={products.slice(0, 4)} onProductClick={goToProductDetail} onAddToCart={addToCart} />
                    <ProductCarousel title="Nuevos Arribos" products={products.slice(4, 8)} onProductClick={goToProductDetail} onAddToCart={addToCart} />
                </div>
            );

            const renderProductList = () => {
                const displayedProducts = getFilteredProducts();
                // Calcular categorías disponibles para el filtro lateral basándose en TODOS los productos
                const availableCats = [...new Set(products.map(p => p.category))];

                return (
                    <div className="container mx-auto px-6 py-8 min-h-screen animate-fade-in flex flex-col md:flex-row gap-8">
                        {/* SIDEBAR DE FILTROS AUTOMÁTICOS */}
                        <aside className="w-full md:w-64 flex-shrink-0">
                            <div className="bg-white p-6 rounded-xl border border-gray-100 sticky top-24">
                                <div className="flex items-center gap-2 font-bold text-lg mb-4 text-slate-900 border-b pb-2">
                                    <FilterIcon size={20} className="text-yellow-500"/> Filtros
                                </div>
                                
                                <div className="mb-6">
                                    <h4 className="font-bold text-sm text-gray-500 mb-3 uppercase tracking-wider">Categorías</h4>
                                    <div className="space-y-2">
                                        {availableCats.map(cat => (
                                            <label key={cat} className="flex items-center gap-2 cursor-pointer hover:text-yellow-600 transition-colors">
                                                <input 
                                                    type="checkbox" 
                                                    checked={activeFilters.categories.includes(cat) || activeCategory === cat}
                                                    onChange={() => {
                                                        if(activeCategory === cat) setActiveCategory(null); // Desactivar si era el principal
                                                        else toggleCategoryFilter(cat);
                                                    }}
                                                    className="rounded text-yellow-500 focus:ring-yellow-500"
                                                />
                                                <span className="text-sm font-medium">{cat}</span>
                                                <span className="text-xs text-gray-400 ml-auto">({products.filter(p => p.category === cat).length})</span>
                                            </label>
                                        ))}
                                    </div>
                                </div>

                                <div className="mb-4">
                                    <h4 className="font-bold text-sm text-gray-500 mb-3 uppercase tracking-wider">Precio</h4>
                                    {/* Placeholder de rango de precio */}
                                    <div className="flex items-center gap-2 text-sm">
                                        <input type="number" placeholder="Min" className="w-full p-2 border rounded" />
                                        -
                                        <input type="number" placeholder="Max" className="w-full p-2 border rounded" />
                                    </div>
                                </div>
                                
                                {(activeFilters.categories.length > 0 || activeCategory) && (
                                    <button 
                                        onClick={() => { setActiveFilters({...activeFilters, categories: []}); setActiveCategory(null); }}
                                        className="text-xs text-red-500 hover:underline w-full text-center mt-2"
                                    >
                                        Limpiar Filtros
                                    </button>
                                )}
                            </div>
                        </aside>

                        {/* GRID DE PRODUCTOS */}
                        <div className="flex-1">
                            <div className="flex justify-between items-center mb-6">
                                <h1 className="text-3xl font-bold text-slate-900">{activeCategory || 'Catálogo Completo'}</h1>
                                <span className="text-gray-500 text-sm">{displayedProducts.length} resultados</span>
                            </div>

                            {displayedProducts.length === 0 ? (
                                <div className="text-center py-20 bg-gray-50 rounded-xl">
                                    <p className="text-gray-500">No se encontraron productos con estos filtros.</p>
                                </div>
                            ) : (
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {displayedProducts.map(p => (
                                        <div key={p.id} onClick={() => goToProductDetail(p)} className="bg-white rounded-xl border border-gray-100 shadow-sm hover:shadow-lg transition-all cursor-pointer group flex flex-col">
                                            <div className="aspect-square p-4 relative overflow-hidden">
                                                <img src={p.image} className="w-full h-full object-contain group-hover:scale-105 transition-transform" />
                                            </div>
                                            <div className="p-4 flex-1 flex flex-col">
                                                <div className="text-xs text-yellow-600 font-bold mb-1 uppercase">{p.category}</div>
                                                <h3 className="font-bold text-slate-800 mb-2">{p.name}</h3>
                                                <div className="mt-auto flex justify-between items-center">
                                                    <span className="text-xl font-bold text-slate-900">${p.price.toFixed(2)}</span>
                                                    <Button className="p-2 rounded-full" onClick={(e)=>{e.stopPropagation(); addToCart(p)}}><ShoppingCart size={18}/></Button>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            const renderProductDetail = () => {
                if (!selectedProduct) return <div>Cargando...</div>;
                const catSlug = selectedProduct.category.toLowerCase().replace(/ /g, '-');
                const specsList = Array.isArray(selectedProduct.specs) ? selectedProduct.specs : (selectedProduct.specs ? selectedProduct.specs.split('|') : []);

                return (
                    <div className="container mx-auto px-6 py-8 min-h-screen animate-fade-in">
                        {/* Breadcrumbs */}
                        <nav className="flex items-center text-sm text-gray-500 mb-6 overflow-x-auto">
                            <span onClick={goHome} className="cursor-pointer hover:text-yellow-600">Inicio</span>
                            <ChevronRight size={14} className="mx-2"/>
                            <span onClick={() => goToProductList(selectedProduct.category)} className="cursor-pointer hover:text-yellow-600">{selectedProduct.category}</span>
                            <ChevronRight size={14} className="mx-2"/>
                            <span className="font-bold text-slate-900">{selectedProduct.name}</span>
                        </nav>

                        <div className="bg-white rounded-3xl border border-gray-100 shadow-lg overflow-hidden flex flex-col lg:flex-row">
                            <div className="lg:w-1/2 p-8 bg-gray-50 flex items-center justify-center">
                                <img src={selectedProduct.image} className="max-w-full max-h-[500px] object-contain drop-shadow-xl" />
                            </div>
                            <div className="lg:w-1/2 p-8 lg:p-12">
                                <span className="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide">{selectedProduct.category}</span>
                                <h1 className="text-4xl font-extrabold text-slate-900 mt-4 mb-2">{selectedProduct.name}</h1>
                                <div className="text-sm text-gray-400 mb-6">SKU: {selectedProduct.sku}</div>
                                <div className="flex items-center gap-4 mb-6">
                                    <span className="text-3xl font-bold text-slate-900">${selectedProduct.price.toFixed(2)}</span>
                                </div>
                                <p className="text-gray-600 text-lg leading-relaxed mb-8">{selectedProduct.longDescription || selectedProduct.description}</p>
                                
                                {specsList.length > 0 && (
                                    <div className="bg-slate-50 p-6 rounded-xl mb-8">
                                        <h3 className="font-bold mb-3">Especificaciones</h3>
                                        <div className="grid grid-cols-2 gap-2 text-sm text-gray-600">
                                            {specsList.map((s, i) => <div key={i} className="flex items-center gap-2"><div className="w-1.5 h-1.5 bg-yellow-500 rounded-full"></div>{s}</div>)}
                                        </div>
                                    </div>
                                )}

                                <Button fullWidth className="text-lg py-4" onClick={() => { addToCart(selectedProduct); navigate('/carrito'); }}>
                                    Agregar al Carrito
                                </Button>
                            </div>
                        </div>
                    </div>
                );
            };

            const renderCart = () => (
                <div className="container mx-auto px-6 py-12 max-w-4xl min-h-screen">
                    <h2 className="text-2xl font-bold mb-6 flex items-center gap-2"><ShoppingCart className="text-yellow-500"/> Carrito ({cart.length})</h2>
                    {cart.length === 0 ? <div className="text-center py-12 bg-gray-50 rounded-xl text-gray-500">Carrito vacío <br/><br/><Button onClick={goHome}>Ir a comprar</Button></div> : (
                        <div className="space-y-4">
                            {cart.map(i => (
                                <div key={i.id} className="flex items-center gap-4 bg-white p-4 rounded-lg border shadow-sm">
                                    <img src={i.image} className="w-20 h-20 object-contain" />
                                    <div className="flex-1">
                                        <h3 className="font-bold">{i.name}</h3>
                                        <p className="text-yellow-600 font-bold">${i.price.toFixed(2)}</p>
                                    </div>
                                    <div className="flex items-center bg-gray-100 rounded">
                                        <button className="px-3 py-1 hover:bg-gray-200" onClick={()=>updateQty(i.id, -1)}>-</button>
                                        <span className="px-3 font-bold">{i.quantity}</span>
                                        <button className="px-3 py-1 hover:bg-gray-200" onClick={()=>updateQty(i.id, 1)}>+</button>
                                    </div>
                                    <button onClick={()=>remove(i.id)} className="text-red-400 hover:text-red-600 p-2"><X/></button>
                                </div>
                            ))}
                            <div className="mt-8 pt-6 border-t flex justify-between items-center">
                                <div><p className="text-gray-500">Total</p><p className="text-3xl font-bold">${cartTotal.toFixed(2)}</p></div>
                                <Button onClick={()=>navigate('/checkout/envio')}>Pagar</Button>
                            </div>
                        </div>
                    )}
                </div>
            );

            // Reutilizamos pantallas de checkout simples
            const renderCheckoutShipping = () => (
                <div className="container mx-auto px-6 py-12 max-w-xl min-h-screen">
                    <h2 className="text-2xl font-bold mb-6">Datos de Envío</h2>
                    <form onSubmit={(e)=>{e.preventDefault(); navigate('/checkout/pago')}} className="space-y-4">
                        <input required placeholder="Nombre" className="w-full p-3 border rounded" value={shippingData.name} onChange={e=>setShippingData({...shippingData, name: e.target.value})}/>
                        <input required placeholder="Email" type="email" className="w-full p-3 border rounded" value={shippingData.email} onChange={e=>setShippingData({...shippingData, email: e.target.value})}/>
                        <input required placeholder="Dirección" className="w-full p-3 border rounded" value={shippingData.address} onChange={e=>setShippingData({...shippingData, address: e.target.value})}/>
                        <div className="flex gap-4"><input required placeholder="Ciudad" className="w-full p-3 border rounded"/><input required placeholder="CP" className="w-full p-3 border rounded"/></div>
                        <Button type="submit" fullWidth>Ir al Pago</Button>
                    </form>
                </div>
            );

            const renderCheckoutPayment = () => (
                <div className="container mx-auto px-6 py-12 max-w-xl min-h-screen">
                    <h2 className="text-2xl font-bold mb-6">Pago Seguro</h2>
                    <div className="bg-gray-50 p-4 rounded mb-6 text-sm text-gray-600">Total a pagar: <strong>${cartTotal.toFixed(2)}</strong></div>
                    <form onSubmit={(e)=>{e.preventDefault(); setIsProcessing(true); setTimeout(()=>{setIsProcessing(false); setCart([]); navigate('/confirmacion')}, 2000)}} className="space-y-4">
                        <input required placeholder="Número Tarjeta" className="w-full p-3 border rounded"/>
                        <div className="flex gap-4"><input required placeholder="MM/YY" className="w-full p-3 border rounded"/><input required placeholder="CVV" type="password" className="w-full p-3 border rounded"/></div>
                        <Button type="submit" fullWidth disabled={isProcessing}>{isProcessing ? 'Procesando...' : 'Pagar Ahora'}</Button>
                    </form>
                </div>
            );

            const renderSuccess = () => (
                <div className="container mx-auto px-6 py-20 text-center min-h-screen">
                    <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6"><CheckCircle size={40} className="text-green-600"/></div>
                    <h2 className="text-3xl font-bold mb-2">¡Gracias por tu compra!</h2>
                    <p className="text-gray-500 mb-8">Hemos enviado los detalles a {shippingData.email}</p>
                    <Button onClick={goHome}>Volver al Inicio</Button>
                </div>
            );

            const renderCategoriesView = () => (
                <div className="container mx-auto px-6 py-12 min-h-screen">
                    <h2 className="text-3xl font-bold mb-8">Categorías</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {categories.map(c => (
                            <div key={c.id} onClick={()=>goToProductList(c.name)} className="bg-slate-100 h-40 rounded-xl flex items-center justify-center cursor-pointer hover:bg-yellow-500 hover:text-white transition-colors">
                                <h3 className="text-2xl font-bold">{c.name}</h3>
                            </div>
                        ))}
                    </div>
                </div>
            );

            return (
                <div className="font-sans text-slate-800 min-h-screen flex flex-col bg-white">
                    <header className="sticky top-0 z-50 bg-slate-900 text-white shadow-lg">
                        <div className="container mx-auto px-6 h-20 flex items-center justify-between">
                            <div onClick={goHome} className="flex items-center gap-2 cursor-pointer">
                                <div className="bg-yellow-500 p-2 rounded-lg"><Truck className="text-slate-900"/></div>
                                <span className="text-xl font-bold hidden sm:block">Vial<span className="text-yellow-500">Pro</span></span>
                            </div>
                            <div className="hidden md:block flex-1 max-w-md mx-8 relative">
                                <input type="text" placeholder="Buscar..." value={searchTerm} onChange={handleSearch} className="w-full py-2 px-4 rounded-full bg-slate-800 border-slate-700 text-white focus:outline-none focus:border-yellow-500"/>
                                {searchResults.length > 0 && (
                                    <div className="absolute top-full left-0 right-0 bg-white text-slate-900 mt-2 rounded-lg shadow-xl overflow-hidden z-50 max-h-60 overflow-y-auto">
                                        {searchResults.map(p => (
                                            <div key={p.id} onClick={()=>{goToProductDetail(p); setSearchTerm(''); setSearchResults([])}} className="p-3 hover:bg-gray-100 cursor-pointer flex gap-3 border-b">
                                                <img src={p.image} className="w-10 h-10 object-contain"/>
                                                <div><p className="font-bold text-sm">{p.name}</p><p className="text-xs text-yellow-600">${p.price.toFixed(2)}</p></div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                            <div className="flex gap-4 items-center">
                                <button onClick={goToCategories} className="hidden md:flex items-center gap-2 font-bold hover:text-yellow-400"><MenuIcon size={20}/> Categorías</button>
                                <div className="relative cursor-pointer" onClick={()=>navigate('/carrito')}>
                                    <ShoppingCart className="hover:text-yellow-400"/>
                                    {cart.length > 0 && <span className="absolute -top-2 -right-2 bg-red-500 text-xs px-1.5 rounded-full">{cart.reduce((a,c)=>a+c.quantity,0)}</span>}
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="flex-1">
                        {view === 'home' && renderHome()}
                        {view === 'product-list' && renderProductList()}
                        {view === 'product-detail' && renderProductDetail()}
                        {view === 'cart' && renderCart()}
                        {view === 'checkout-shipping' && renderCheckoutShipping()}
                        {view === 'checkout-payment' && renderCheckoutPayment()}
                        {view === 'success' && renderSuccess()}
                        {view === 'categories' && renderCategoriesView()}
                    </main>

                    <footer className="bg-slate-900 text-slate-400 py-12 border-t border-slate-800 text-center">
                        <div className="container mx-auto px-6">
                            <p>© 2024 VialPro S.A. de C.V.</p>
                        </div>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
